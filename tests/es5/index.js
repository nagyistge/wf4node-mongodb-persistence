"use strict";
var es6 = true;
try {
  eval("(function *(){})");
} catch (err) {
  es6 = false;
}
var es = es6 ? "es6" : "es5";
var wf4node = require("workflow-4-node");
var MongoDDPersistence = require("../../").MongoDDPersistence;
var hostingTestCommon = require("../../node_modules/workflow-4-node/tests/" + es + "/hosting/hostingTestCommon");
var Serializer = require("backpack-node").system.Serializer;
var connStr = process.env.MONGO_URL;
var persistence = connStr ? new MongoDDPersistence({connection: connStr}) : null;
if (persistence) {
  describe("WorkflowHost", function() {
    this.timeout(5000);
    this.beforeEach(function(done) {
      persistence.__clear().nodeify(done);
    });
    function getInfo(options) {
      return ("lazy: " + (options.lazyPersistence ? "yes" : "no") + ", serializer: " + (options.serializer ? "yes" : "no") + ", alwaysLoad: " + (options.alwaysLoadState ? "yes" : "no"));
    }
    function testBasic(options) {
      it("should run by: " + getInfo(options), function(done) {
        hostingTestCommon.doBasicHostTest(options).nodeify(done);
      });
    }
    function testCalc(options) {
      it("should run by: " + getInfo(options), function(done) {
        hostingTestCommon.doCalculatorTest(options).nodeify(done);
      });
    }
    function testDelayTo(options) {
      it("should run by: " + getInfo(options), function(done) {
        hostingTestCommon.doDelayTest(options).nodeify(done);
      });
    }
    function testStopOutdatedVersions(options) {
      it("should run by: " + getInfo(options), function(done) {
        hostingTestCommon.doStopOutdatedVersionsTest(options).nodeify(done);
      });
    }
    var allOptions = [{
      persistence: persistence,
      lazyPersistence: false,
      serializer: null,
      alwaysLoadState: false
    }, {
      persistence: persistence,
      lazyPersistence: true,
      serializer: null,
      alwaysLoadState: false
    }, {
      persistence: persistence,
      lazyPersistence: false,
      serializer: new Serializer(),
      alwaysLoadState: false
    }, {
      persistence: persistence,
      lazyPersistence: true,
      serializer: new Serializer(),
      alwaysLoadState: false
    }, {
      persistence: persistence,
      lazyPersistence: false,
      serializer: new Serializer(),
      alwaysLoadState: true
    }, {
      persistence: persistence,
      lazyPersistence: true,
      serializer: new Serializer(),
      alwaysLoadState: true
    }];
    describe("With MongoDB Persistence", function() {
      describe("Basic Example", function() {
        var $__4 = true;
        var $__5 = false;
        var $__6 = undefined;
        try {
          for (var $__2 = void 0,
              $__1 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
            var opt = $__2.value;
            {
              testBasic(opt);
            }
          }
        } catch ($__7) {
          $__5 = true;
          $__6 = $__7;
        } finally {
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
        }
      });
      describe("Calculator Example", function() {
        var $__4 = true;
        var $__5 = false;
        var $__6 = undefined;
        try {
          for (var $__2 = void 0,
              $__1 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
            var opt = $__2.value;
            {
              testCalc(opt);
            }
          }
        } catch ($__7) {
          $__5 = true;
          $__6 = $__7;
        } finally {
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
        }
      });
      describe("DelayTo Example", function() {
        var $__4 = true;
        var $__5 = false;
        var $__6 = undefined;
        try {
          for (var $__2 = void 0,
              $__1 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
            var opt = $__2.value;
            {
              testDelayTo(opt);
            }
          }
        } catch ($__7) {
          $__5 = true;
          $__6 = $__7;
        } finally {
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
        }
      });
      describe("StopOutdatedVersions Example", function() {
        var $__4 = true;
        var $__5 = false;
        var $__6 = undefined;
        try {
          for (var $__2 = void 0,
              $__1 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
            var opt = $__2.value;
            {
              testStopOutdatedVersions(opt);
            }
          }
        } catch ($__7) {
          $__5 = true;
          $__6 = $__7;
        } finally {
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
        }
      });
    });
  });
}
//# sourceMappingURL=data:application/json;base64,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QUFLLENBQUEsV0FBdUIsR0FBSyxLQUFHLENBQUc7QUFDMUQsd0JBQXdCLEFBQUMsRUFBQyxDQUFDO1lBQzdCO0FBQUEsVUFDRixDQUFFLE9BQVE7QUFDUixvQkFBd0I7QUFDdEIsd0JBQXdCO1lBQzFCO0FBQUEsVUFDRjtBQUFBLFFBQ0Y7QUFBQSxNQW1HSSxDQUFDLENBQUM7SUFDTixDQUFDLENBQUM7RUFDTixDQUFDLENBQUM7QUFDTjtBQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6InRlc3RzL2VzNiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG5cclxuLyogZ2xvYmFsIGRlc2NyaWJlLGl0ICovXHJcblxyXG52YXIgZXM2ID0gdHJ1ZTtcclxudHJ5IHtcclxuICAgIGV2YWwoXCIoZnVuY3Rpb24gKigpe30pXCIpO1xyXG59IGNhdGNoIChlcnIpIHtcclxuICAgIGVzNiA9IGZhbHNlO1xyXG59XHJcblxyXG52YXIgZXMgPSBlczYgPyBcImVzNlwiIDogXCJlczVcIjtcclxuXHJcbmxldCB3ZjRub2RlID0gcmVxdWlyZShcIndvcmtmbG93LTQtbm9kZVwiKTtcclxubGV0IE1vbmdvRERQZXJzaXN0ZW5jZSA9IHJlcXVpcmUoXCIuLi8uLi9cIikuTW9uZ29ERFBlcnNpc3RlbmNlO1xyXG5sZXQgaG9zdGluZ1Rlc3RDb21tb24gPSByZXF1aXJlKFwiLi4vLi4vbm9kZV9tb2R1bGVzL3dvcmtmbG93LTQtbm9kZS90ZXN0cy9cIiArIGVzICsgXCIvaG9zdGluZy9ob3N0aW5nVGVzdENvbW1vblwiKTtcclxubGV0IFNlcmlhbGl6ZXIgPSByZXF1aXJlKFwiYmFja3BhY2stbm9kZVwiKS5zeXN0ZW0uU2VyaWFsaXplcjtcclxuXHJcbmxldCBjb25uU3RyID0gcHJvY2Vzcy5lbnYuTU9OR09fVVJMO1xyXG5sZXQgcGVyc2lzdGVuY2UgPSBjb25uU3RyID8gbmV3IE1vbmdvRERQZXJzaXN0ZW5jZSh7Y29ubmVjdGlvbjogY29ublN0cn0pIDogbnVsbDtcclxuXHJcbmlmIChwZXJzaXN0ZW5jZSkge1xyXG4gICAgZGVzY3JpYmUoXCJXb3JrZmxvd0hvc3RcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMudGltZW91dCg1MDAwKTtcclxuICAgICAgICB0aGlzLmJlZm9yZUVhY2goZnVuY3Rpb24oZG9uZSkge1xyXG4gICAgICAgICAgICBwZXJzaXN0ZW5jZS5fX2NsZWFyKCkubm9kZWlmeShkb25lKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0SW5mbyhvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgbGF6eTogJHtvcHRpb25zLmxhenlQZXJzaXN0ZW5jZSA/IFwieWVzXCIgOiBcIm5vXCJ9LCBzZXJpYWxpemVyOiAke29wdGlvbnMuc2VyaWFsaXplciA/IFwieWVzXCIgOiBcIm5vXCJ9LCBhbHdheXNMb2FkOiAke29wdGlvbnMuYWx3YXlzTG9hZFN0YXRlID8gXCJ5ZXNcIiA6IFwibm9cIn1gO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdGVzdEJhc2ljKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgaXQoXCJzaG91bGQgcnVuIGJ5OiBcIiArIGdldEluZm8ob3B0aW9ucyksIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgICAgICAgICBob3N0aW5nVGVzdENvbW1vbi5kb0Jhc2ljSG9zdFRlc3Qob3B0aW9ucykubm9kZWlmeShkb25lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB0ZXN0Q2FsYyhvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9DYWxjdWxhdG9yVGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRlc3REZWxheVRvKG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgaXQoXCJzaG91bGQgcnVuIGJ5OiBcIiArIGdldEluZm8ob3B0aW9ucyksIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgICAgICAgICBob3N0aW5nVGVzdENvbW1vbi5kb0RlbGF5VGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRlc3RTdG9wT3V0ZGF0ZWRWZXJzaW9ucyhvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9TdG9wT3V0ZGF0ZWRWZXJzaW9uc1Rlc3Qob3B0aW9ucykubm9kZWlmeShkb25lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYWxsT3B0aW9ucyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGVyc2lzdGVuY2U6IHBlcnNpc3RlbmNlLFxyXG4gICAgICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IGZhbHNlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBwZXJzaXN0ZW5jZSxcclxuICAgICAgICAgICAgICAgIGxhenlQZXJzaXN0ZW5jZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IGZhbHNlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBwZXJzaXN0ZW5jZSxcclxuICAgICAgICAgICAgICAgIGxhenlQZXJzaXN0ZW5jZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxyXG4gICAgICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwZXJzaXN0ZW5jZTogcGVyc2lzdGVuY2UsXHJcbiAgICAgICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxyXG4gICAgICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwZXJzaXN0ZW5jZTogcGVyc2lzdGVuY2UsXHJcbiAgICAgICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2VyaWFsaXplcjogbmV3IFNlcmlhbGl6ZXIoKSxcclxuICAgICAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwZXJzaXN0ZW5jZTogcGVyc2lzdGVuY2UsXHJcbiAgICAgICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxyXG4gICAgICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBkZXNjcmliZShcIldpdGggTW9uZ29EQiBQZXJzaXN0ZW5jZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGRlc2NyaWJlKFwiQmFzaWMgRXhhbXBsZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBvcHQgb2YgYWxsT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RCYXNpYyhvcHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGRlc2NyaWJlKFwiQ2FsY3VsYXRvciBFeGFtcGxlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG9wdCBvZiBhbGxPcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdENhbGMob3B0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBkZXNjcmliZShcIkRlbGF5VG8gRXhhbXBsZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBvcHQgb2YgYWxsT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3REZWxheVRvKG9wdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZGVzY3JpYmUoXCJTdG9wT3V0ZGF0ZWRWZXJzaW9ucyBFeGFtcGxlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG9wdCBvZiBhbGxPcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdFN0b3BPdXRkYXRlZFZlcnNpb25zKG9wdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0iXX0=
